<div class="booking-hero">
  <div class="hero-container">
    <div class="hero-content">
      <div class="hero-title">
        <span class="title-main">ุญุฌุฒ ููุนุฏ ุทุจู</span>
        <span class="title-sub">Book Your Medical Appointment</span>
      </div>
      <p class="hero-description">
        ุงุญุฌุฒ ููุนุฏู ุจุณูููุฉ ูู ุนูุงุฏุงุชูุง ุงููุชุฎุตุตุฉ. ุงุฎุชุฑ ุงูุนูุงุฏุฉุ ุญุฏุฏ ุงูููุชุ ูุฃููู ุจูุงูุงุชู ูู ุฎุทูุงุช ุจุณูุทุฉ.
      </p>
    </div>
  </div>
</div>

<div class="progress-section">
  <div class="progress-container">
    <div class="progress-steps">
      <div class="step" [ngClass]="{'active': currentStep === 1, 'completed': currentStep > 1}">
        <span class="step-number">1</span>
        <span class="step-label">ุจูุงูุงุชู ุงูุดุฎุตูุฉ</span>
      </div>
      <div class="step" [ngClass]="{'active': currentStep === 2, 'completed': currentStep > 2}">
        <span class="step-number">2</span>
        <span class="step-label">ุงุฎุชูุงุฑ ุงูุนูุงุฏุฉ</span>
      </div>
      <div class="step" [ngClass]="{'active': currentStep === 3}">
        <span class="step-number">3</span>
        <span class="step-label">ููุนุฏ ุงูุญุฌุฒ</span>
      </div>
    </div>
  </div>
</div>

<div class="booking-section">
  <div class="booking-container">
    <div class="error-message server-error" *ngIf="errorMessage">{{errorMessage}}</div>
    <form class="booking-form" [formGroup]="bookingForm" (ngSubmit)="onSubmit()">
      <!-- Step 1: Personal Information -->
      <div class="form-step" [ngClass]="{'active': currentStep === 1}">
        <div class="step-header">
          <h2 class="step-title">
            <span class="step-icon">๐</span>
            ุจูุงูุงุชู ุงูุดุฎุตูุฉ
          </h2>
          <p class="step-description">ูุฑุฌู ุฅุฏุฎุงู ูุนูููุงุชู ุงูุดุฎุตูุฉ ุจุฏูุฉ</p>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="name">ุงูุงุณู ุงููุงูู<span class="required">*</span></label>
            <div class="input-wrapper">
              <span class="input-icon">๐ค</span>
              <input class="form-input" [ngClass]="{'error': getFieldError('name')}" id="name" formControlName="name" type="text" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู">
            </div>
            <div class="error-message" *ngIf="getFieldError('name')">{{getFieldError('name')}}</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู<span class="required">*</span></label>
            <div class="input-wrapper">
              <span class="input-icon">๐ง</span>
              <input class="form-input" [ngClass]="{'error': getFieldError('email')}" id="email" formControlName="email" type="email" placeholder="ุฃุฏุฎู ุจุฑูุฏู ุงูุฅููุชุฑููู">
            </div>
            <div class="error-message" *ngIf="getFieldError('email')">{{getFieldError('email')}}</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="phone">ุฑูู ุงููุงุชู<span class="required">*</span></label>
            <div class="input-wrapper">
              <span class="input-icon">๐</span>
              <input class="form-input" [ngClass]="{'error': getFieldError('phone')}" id="phone" formControlName="phone" type="tel" placeholder="ุฃุฏุฎู ุฑูู ูุงุชูู">
            </div>
            <div class="error-message" *ngIf="getFieldError('phone')">{{getFieldError('phone')}}</div>
          </div>
          <div class="form-group full-width">
            <label class="form-label" for="address">ุงูุนููุงู<span class="required">*</span></label>
            <div class="input-wrapper">
              <span class="input-icon">๐</span>
              <input class="form-input" [ngClass]="{'error': getFieldError('address')}" id="address" formControlName="address" type="text" placeholder="ุฃุฏุฎู ุนููุงูู">
            </div>
            <div class="error-message" *ngIf="getFieldError('address')">{{getFieldError('address')}}</div>
          </div>
        </div>
      </div>

      <!-- Step 2: Clinic Selection -->
      <div class="form-step" [ngClass]="{'active': currentStep === 2}">
        <div class="step-header">
          <h2 class="step-title">
            <span class="step-icon">๐ฅ</span>
            ุงุฎุชูุงุฑ ุงูุนูุงุฏุฉ
          </h2>
          <p class="step-description">ุงุฎุชุฑ ุงูุนูุงุฏุฉ ุงูุชู ุชุฑุบุจ ุจุญุฌุฒ ููุนุฏ ุจูุง</p>
        </div>
        <div class="form-group full-width">
          <label class="form-label" for="clinicId">ุงูุนูุงุฏุฉ<span class="required">*</span></label>
          <div class="clinics-grid">
            <div class="clinic-option" *ngFor="let clinic of clinics; trackBy: trackByClinicId"
                 [ngClass]="{'selected': bookingForm.get('clinicId')?.value === clinic.id}"
                 (click)="selectClinic(clinic.id)">
              <span class="clinic-icon" [style.backgroundColor]="clinic.color">{{clinic.icon}}</span>
              <div class="clinic-info">
                <div class="clinic-name">{{clinic.name}}</div>
                <div class="clinic-name-en">{{clinic.nameEn}}</div>
              </div>
              <span class="selection-indicator">โ</span>
            </div>
          </div>
          <div class="error-message" *ngIf="getFieldError('clinicId')">{{getFieldError('clinicId')}}</div>
        </div>
      </div>

      <!-- Step 3: Appointment Details -->
      <div class="form-step" [ngClass]="{'active': currentStep === 3}">
        <div class="step-header">
          <h2 class="step-title">
            <span class="step-icon">๐</span>
            ููุนุฏ ุงูุญุฌุฒ
          </h2>
          <p class="step-description">ุงุฎุชุฑ ุงูุชุงุฑูุฎ ูุงูููุช ุงูููุงุณุจูู ูู</p>
        </div>
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label" for="appointmentDate">ุชุงุฑูุฎ ุงูููุนุฏ<span class="required">*</span></label>
            <div class="input-wrapper">
              <span class="input-icon">๐</span>
              <input class="form-input" [ngClass]="{'error': getFieldError('appointmentDate'), 'highlight': !isDateSelected}"
                     id="appointmentDate" formControlName="appointmentDate" type="date"
                     [min]="minDate" [max]="maxDate" (click)="onDateClick()">
            </div>
            <div class="error-message" *ngIf="getFieldError('appointmentDate')">{{getFieldError('appointmentDate')}}</div>
          </div>
          <div class="form-group">
            <label class="form-label" for="appointmentTime">ููุช ุงูููุนุฏ<span class="required">*</span></label>
            <div class="time-slots-container">
              <div class="time-slots">
                <div class="time-slot" *ngFor="let time of displayedTimes; trackBy: trackByTime"
                     [ngClass]="{'selected': bookingForm.get('appointmentTime')?.value === time}"
                     (click)="bookingForm.get('appointmentTime')?.setValue(time)">
                  <span class="time-text">{{time}}</span>
                  <span class="time-period">{{time < '12:00' ? 'ุตุจุงุญูุง' : 'ูุณุงุกู'}}</span>
                </div>
              </div>
              <div class="time-navigation">
                <button type="button" class="btn-secondary load-previous" *ngIf="hasPreviousTimes" (click)="loadPreviousTimes()">
                  ุนุฑุถ ุงูุณุงุจู
                </button>
                <button type="button" class="btn-secondary load-more" *ngIf="hasMoreTimes" (click)="loadMoreTimes()">
                  ุชุญููู ุงููุฒูุฏ
                </button>
              </div>
            </div>
            <div class="error-message" *ngIf="getFieldError('appointmentTime')">{{getFieldError('appointmentTime')}}</div>
          </div>
        </div>
      </div>

      <!-- Form Navigation -->
      <div class="form-navigation">
        <button *ngIf="currentStep > 1" type="button" class="btn-secondary" (click)="prevStep()">
          <span class="btn-icon">โฌ๏ธ</span>
          ุงูุณุงุจู
        </button>
        <button *ngIf="currentStep < totalSteps" type="button" class="btn-primary" [disabled]="!isCurrentStepValid()" (click)="nextStep()">
          ุงูุชุงูู
          <span class="btn-icon">โก๏ธ</span>
        </button>
        <button *ngIf="currentStep === totalSteps" type="submit" class="btn-primary submit-btn" [disabled]="isLoading || !bookingForm.valid">
          <span *ngIf="isLoading" class="btn-icon btn-spinner">โณ</span>
          <span *ngIf="!isLoading" class="btn-icon">โ</span>
          ุชุฃููุฏ ุงูุญุฌุฒ
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Success Popup -->
<div class="success-popup" *ngIf="isSubmitted && createdBooking">
  <div class="popup-overlay"></div>
  <div class="success-content">
    <button class="close-button" (click)="resetForm()">โ</button>
    <div class="success-icon">๐</div>
    <h2 class="success-title">ุชู ุชุฃููุฏ ุงูุญุฌุฒ!</h2>
    <p class="success-message">
      ุดูุฑูุง ูู! ููุฏ ุชู ุญุฌุฒ ููุนุฏู ุจูุฌุงุญ. ุณูุชู ุฅุฑุณุงู ุชุฃููุฏ ุงูุญุฌุฒ ุฅูู ุจุฑูุฏู ุงูุฅููุชุฑููู.
    </p>
    <div class="success-details">
      <div class="detail-item">
        <span class="detail-label">ุฑูู ุงูุญุฌุฒ</span>
        <span class="detail-value">{{createdBooking.bookingNumber}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">ููุฏ ุงูุชุฃููุฏ</span>
        <span class="detail-value">{{createdBooking.confirmationCode}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">ุงูุงุณู</span>
        <span class="detail-value">{{createdBooking.clientName}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">ุงูุนูุงุฏุฉ</span>
        <span class="detail-value">{{selectedClinic?.name}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">ุงูุชุงุฑูุฎ</span>
        <span class="detail-value">{{createdBooking.date | date: 'yyyy-MM-dd'}}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">ุงูููุช</span>
        <span class="detail-value">{{createdBooking.time}}</span>
      </div>
    </div>
    <div class="success-actions">
      <button class="btn-primary" (click)="resetForm()">ุญุฌุฒ ููุนุฏ ุขุฎุฑ</button>
      <a class="btn-secondary" href="/">ุงูุนูุฏุฉ ุฅูู ุงูุฑุฆูุณูุฉ</a>
    </div>
  </div>
</div>
