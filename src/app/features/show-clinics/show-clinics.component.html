
<main class="clinic-page">
  <!-- Hero Section -->
  <section class="hero-section" *ngIf="clinic && !loading" [style.background]="clinic.gradient">
    <div class="hero-overlay"></div>
    <div class="hero-container">
      <div class="hero-content">
        <div class="hero-icon" [style.background]="clinic.color">
          <span>{{ clinic.icon }}</span>
        </div>
        <h1 class="hero-title">{{ clinic.name }}</h1>
        <p class="hero-subtitle">{{ clinic.nameEn }}</p>
        <p class="hero-description">{{ clinic.about || clinic.description || 'لا توجد معلومات متاحة' }}</p>

        <!-- Hero Stats -->
        <div class="hero-stats" *ngIf="clinic.totalBookings">
          <div class="stat-item">
            <span class="stat-number">{{ clinic.totalBookings }}</span>
            <span class="stat-label">مريض</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ clinic.doctors?.length || 0 }}</span>
            <span class="stat-label">طبيب</span>
          </div>
          <div class="stat-item" *ngIf="clinic.price">
            <span class="stat-number">{{ clinic.price }}</span>
            <span class="stat-label">ريال</span>
          </div>
        </div>

        <div class="hero-actions">
          <button class="btn-primary" (click)="bookAppointment()">
            <span class="btn-icon">📅</span>
            <span class="btn-text">حجز موعد الآن</span>
          </button>
          <button class="btn-secondary" (click)="scrollToContact()">
            <span class="btn-icon">📞</span>
            <span class="btn-text">تواصل معنا</span>
          </button>
        </div>
      </div>
      <div class="hero-pattern" [attr.data-pattern]="clinic.bgPattern"></div>
    </div>
  </section>

  <!-- Main Content -->
  <div class="main-content" *ngIf="clinic && !loading">
    <div class="container">

      <!-- About Section -->
      <section class="content-section about-section">
        <div class="section-header">
          <h2 class="section-title">نبذة عن العيادة</h2>
          <div class="section-divider"></div>
        </div>
        <div class="about-content">
          <div class="about-text">
            <p class="about-description">{{ clinic.about || clinic.description || 'لا توجد معلومات متاحة' }}</p>
            <div class="about-meta">
              <div class="meta-item" *ngIf="clinic.createdAt">
                <i class="icon">📅</i>
                <span>تأسست في: {{ clinic.createdAt | date:'MMMM yyyy' }}</span>
              </div>
              <div class="meta-item" *ngIf="clinic.email !== 'غير متوفر'">
                <i class="icon">📧</i>
                <span>{{ clinic.email }}</span>
              </div>
            </div>
          </div>
          <div class="about-visual">
            <div class="clinic-badge" [style.background]="clinic.gradient">
              <span class="badge-icon">{{ clinic.icon }}</span>
              <h3 class="badge-title">{{ clinic.name }}</h3>
            </div>
          </div>
        </div>
      </section>

      <!-- Specialties Section -->
      <section class="content-section specialties-section">
        <div class="section-header">
          <h2 class="section-title">التخصصات الرئيسية</h2>
          <div class="section-divider"></div>
        </div>
        <div class="specialties-grid" *ngIf="clinic.specialWords?.length || clinic.specialties?.length; else noSpecialties">
          <!-- Special Words -->
          <div class="specialty-card featured" *ngFor="let word of clinic.specialWords?.slice(0, 6)" [style.borderColor]="clinic.color">
            <div class="specialty-icon" [style.background]="clinic.color">
              <span>⭐</span>
            </div>
            <h4 class="specialty-title">{{ word }}</h4>
            <span class="specialty-badge">تخصص رئيسي</span>
          </div>

          <!-- Regular Specialties -->
          <div class="specialty-card" *ngFor="let specialty of clinic.specialties?.slice(0, 6)" [style.borderColor]="clinic.color + '40'">
            <div class="specialty-icon secondary" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>✓</span>
            </div>
            <h4 class="specialty-title">{{ specialty }}</h4>
            <span class="specialty-badge secondary">خدمة متاحة</span>
          </div>
        </div>
        <ng-template #noSpecialties>
          <div class="no-data-card">
            <span class="no-data-icon">🏥</span>
            <p>لا توجد تخصصات محددة حالياً</p>
          </div>
        </ng-template>
      </section>

      <!-- Operating Hours -->
      <section class="content-section hours-section">
        <div class="section-header">
          <h2 class="section-title">أوقات العمل والتكلفة</h2>
          <div class="section-divider"></div>
        </div>
        <div class="hours-grid">
          <div class="hours-card">
            <div class="card-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>🕐</span>
            </div>
            <h4 class="card-title">الأيام المتاحة</h4>
            <p class="card-content">{{ getTranslatedAvailableDays() }}</p>
          </div>
          <div class="hours-card" *ngIf="clinic.price">
            <div class="card-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>💰</span>
            </div>
            <h4 class="card-title">التكلفة التقريبية</h4>
            <p class="card-content">{{ clinic.price }} ريال سعودي</p>
          </div>
          <div class="hours-card">
            <div class="card-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>📊</span>
            </div>
            <h4 class="card-title">حجوزات اليوم</h4>
            <p class="card-content">{{ clinic.bookingsToday || 0 }} موعد</p>
          </div>
        </div>
      </section>

      <!-- Doctors Section -->
      <section class="content-section doctors-section" *ngIf="clinic.doctors?.length; else noDoctors">
        <div class="section-header">
          <h2 class="section-title">الأطباء المتخصصون</h2>
          <div class="section-divider"></div>
          <p class="section-subtitle">تعرف على فريقنا الطبي المتميز</p>
        </div>

        <div class="doctors-list">
          <div class="doctor-card" *ngFor="let doctor of clinic.doctors; let i = index">
            <div class="row">
              <!-- Doctor Info Column -->
              <div class="col-md-6">
                <div class="doctor-info">
                  <div class="doctor-header">
                    <h3 class="doctor-name">{{ doctor.name }}</h3>
                    <span class="doctor-status" [class.active]="doctor.status === 'متاح'">
                      {{ doctor.status }}
                    </span>
                  </div>

                  <div class="doctor-details">
                    <div class="detail-item">
                      <span class="detail-icon">🎓</span>
                      <div class="detail-content">
                        <span class="detail-label">التخصص</span>
                        <span class="detail-value">{{ doctor.specialization }}</span>
                      </div>
                    </div>

                    <div class="detail-item">
                      <span class="detail-icon">⏱️</span>
                      <div class="detail-content">
                        <span class="detail-label">سنوات الخبرة</span>
                        <span class="detail-value">{{ doctor.yearsOfExperience }} سنة</span>
                      </div>
                    </div>

                    <div class="detail-item" *ngIf="doctor.email">
                      <span class="detail-icon">📧</span>
                      <div class="detail-content">
                        <span class="detail-label">البريد الإلكتروني</span>
                        <span class="detail-value">{{ doctor.email }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="doctor-about">
                    <h5 class="about-title">نبذة عن الطبيب</h5>
                    <p class="about-text">{{ doctor.about }}</p>
                  </div>

                  <!-- Doctor Specialties -->
                  <div class="doctor-specialties" *ngIf="doctor.specialWords?.length">
                    <h5 class="specialties-title">التخصصات الفرعية</h5>
                    <div class="specialties-tags">
                      <span class="specialty-tag" *ngFor="let word of doctor.specialWords" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
                        {{ word }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Doctor Image Column -->
              <div class="col-md-6">
                <div class="doctor-image-container">
                  <div class="image-wrapper" *ngIf="getDoctorImageUrl(doctor); else imagePlaceholder">
                    <img
                      [src]="getDoctorImageUrl(doctor)!"
                      [alt]="'صورة الطبيب ' + doctor.name"
                      (load)="handleImageLoad(doctor._id)"
                      (error)="handleImageError($event, doctor._id)"
                      class="doctor-image"
                      loading="lazy"
                    />
                    <div class="image-overlay" *ngIf="!imageLoadingStatus[doctor._id]">
                      <div class="loading-spinner"></div>
                    </div>
                  </div>
                  <ng-template #imagePlaceholder>
                    <div class="image-placeholder">
                      <span class="placeholder-icon">👨‍⚕️</span>
                      <p class="placeholder-text">{{ doctor.name }}</p>
                    </div>
                  </ng-template>

                  <!-- Doctor Badge -->
                  <div class="doctor-badge" [style.background]="clinic.gradient">
                    <span class="badge-text">طبيب معتمد</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <ng-template #noDoctors>
        <section class="content-section doctors-section">
          <div class="section-header">
            <h2 class="section-title">الأطباء المتخصصون</h2>
            <div class="section-divider"></div>
          </div>
          <div class="no-data-card">
            <span class="no-data-icon">👨‍⚕️</span>
            <p>لا يوجد أطباء مرتبطين بهذه العيادة حالياً</p>
          </div>
        </section>
      </ng-template>

      <!-- Videos Section -->
      <section class="content-section videos-section" *ngIf="clinic.videos?.length; else noVideos">
        <div class="section-header">
          <h2 class="section-title">الفيديوهات التوضيحية</h2>
          <div class="section-divider"></div>
          <p class="section-subtitle">شاهد المزيد حول خدماتنا الطبية</p>
        </div>

        <div class="video-player-container">
          <!-- Main Video Player -->
          <div class="main-video-wrapper">
            <div class="video-player-frame">
              <video
                #mainVideoPlayer
                [src]="getVideoUrl(selectedVideo || clinic.videos[0])"
                controls
                preload="metadata"
                (canplay)="handleVideoLoad(selectedVideo || clinic.videos[0])"
                (error)="handleVideoError($event)"
                class="main-video-player"
                poster="/assets/images/video-poster.jpg"
              >
                <source [src]="getVideoUrl(selectedVideo || clinic.videos[0])" type="video/mp4">
                <p>عذرًا، متصفحك لا يدعم تشغيل الفيديو.</p>
              </video>

              <div class="video-loading-overlay" *ngIf="!videoLoaded[selectedVideo || clinic.videos[0]]">
                <div class="loading-spinner"></div>
                <p>جاري تحميل الفيديو...</p>
              </div>

              <!-- Video Info Overlay -->
              <div class="video-info-overlay">
                <h4 class="video-title">فيديو توضيحي {{ getVideoIndex() + 1 }}</h4>
                <p class="video-subtitle">{{ clinic.name }}</p>
              </div>
            </div>
          </div>

          <!-- Video Playlist -->
          <div class="video-playlist" *ngIf="clinic.videos.length > 1">
            <h4 class="playlist-title">قائمة الفيديوهات</h4>
            <div class="playlist-items">
              <div
                class="playlist-item"
                *ngFor="let video of clinic.videos; let i = index"
                [class.active]="(selectedVideo || clinic.videos[0]) === video"
                (click)="selectVideo(video)"
              >
                <div class="playlist-thumbnail">
                  <video
                    [src]="getVideoUrl(video)"
                    preload="metadata"
                    class="thumbnail-video"
                  ></video>
                  <div class="play-overlay">
                    <span class="play-icon">▶</span>
                  </div>
                  <div class="video-number">{{ i + 1 }}</div>
                </div>
                <div class="playlist-info">
                  <h5 class="playlist-video-title">فيديو رقم {{ i + 1 }}</h5>
                  <p class="playlist-video-subtitle">{{ clinic.name }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <ng-template #noVideos>
        <section class="content-section videos-section">
          <div class="section-header">
            <h2 class="section-title">الفيديوهات التوضيحية</h2>
            <div class="section-divider"></div>
          </div>
          <div class="no-data-card">
            <span class="no-data-icon">🎥</span>
            <p>لا توجد فيديوهات متاحة حالياً</p>
          </div>
        </section>
      </ng-template>

      <!-- Contact Section -->
      <section class="content-section contact-section" id="contact">
        <div class="section-header">
          <h2 class="section-title">تواصل معنا</h2>
          <div class="section-divider"></div>
          <p class="section-subtitle">نحن هنا لخدمتك في أي وقت</p>
        </div>

        <div class="contact-grid">
          <div class="contact-card" *ngIf="clinic.phone && clinic.phone !== 'غير متوفر'">
            <div class="contact-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>📞</span>
            </div>
            <div class="contact-info">
              <h4 class="contact-title">رقم الهاتف</h4>
              <p class="contact-detail">{{ clinic.phone }}</p>
              <a href="tel:{{ clinic.phone }}" class="contact-action">اتصل الآن</a>
            </div>
          </div>

          <div class="contact-card" *ngIf="clinic.email && clinic.email !== 'غير متوفر'">
            <div class="contact-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>📧</span>
            </div>
            <div class="contact-info">
              <h4 class="contact-title">البريد الإلكتروني</h4>
              <p class="contact-detail">{{ clinic.email }}</p>
              <a href="mailto:{{ clinic.email }}" class="contact-action">إرسال إيميل</a>
            </div>
          </div>

          <div class="contact-card" *ngIf="clinic.address && clinic.address !== 'غير متوفر'">
            <div class="contact-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>📍</span>
            </div>
            <div class="contact-info">
              <h4 class="contact-title">العنوان</h4>
              <p class="contact-detail">{{ clinic.address }}</p>
              <a href="#" class="contact-action" (click)="openMap()">عرض على الخريطة</a>
            </div>
          </div>
        </div>
      </section>

      <!-- CTA Section -->
      <section class="content-section cta-section">
        <div class="cta-container" [style.background]="clinic.gradient">
          <div class="cta-content">
            <h2 class="cta-title">احجز موعدك الآن</h2>
            <p class="cta-subtitle">لا تتردد في التواصل معنا لحجز موعدك والحصول على أفضل رعاية طبية</p>
            <div class="cta-actions">
              <button class="btn-cta primary" (click)="bookAppointment()">
                <span class="btn-icon">📅</span>
                <span class="btn-text">حجز موعد</span>
              </button>
              <button class="btn-cta secondary" (click)="scrollToContact()">
                <span class="btn-icon">📞</span>
                <span class="btn-text">تواصل معنا</span>
              </button>
            </div>
          </div>
          <div class="cta-visual">
            <div class="cta-icon" [style.background]="clinic.color">
              <span>{{ clinic.icon }}</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Statistics Section -->
      <section class="content-section stats-section" *ngIf="clinic.totalBookings || clinic.bookingsToday">
        <div class="section-header">
          <h2 class="section-title">إحصائيات العيادة</h2>
          <div class="section-divider"></div>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>📅</span>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ clinic.bookingsToday || 0 }}</h3>
              <p class="stat-label">حجوزات اليوم</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>📊</span>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ clinic.bookingsLast7Days || 0 }}</h3>
              <p class="stat-label">آخر 7 أيام</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>📈</span>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ clinic.bookingsLast30Days || 0 }}</h3>
              <p class="stat-label">آخر 30 يوم</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon" [style.background]="clinic.color + '20'" [style.color]="clinic.color">
              <span>🏆</span>
            </div>
            <div class="stat-content">
              <h3 class="stat-number">{{ clinic.totalBookings || 0 }}</h3>
              <p class="stat-label">إجمالي المرضى</p>
            </div>
          </div>
        </div>
      </section>

    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p class="loading-text">جاري تحميل تفاصيل العيادة...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && !clinic" class="error-container">
    <div class="error-content">
      <span class="error-icon">⚠️</span>
      <h2 class="error-title">عذراً</h2>
      <p class="error-message">{{ errorMessage || 'لم يتم العثور على تفاصيل العيادة' }}</p>
      <button class="btn-retry" (click)="ngOnInit()">إعادة المحاولة</button>
    </div>
  </div>

  <!-- Background Pattern -->
  <div class="page-bg-pattern" [attr.data-pattern]="clinic?.bgPattern"></div>
</main>
