<app-sidebar></app-sidebar>

<section class="dashboard-section" dir="rtl">
  <div class="dashboard-container">
    <!-- Search Bar and Main Website Button -->
    <div class="header-row">
      <div class="search-bar">
        <form class="search-form" role="search" aria-label="بحث في لوحة التحكم">
          <div class="form-group">
            <i class="fas fa-search search-icon"></i>
            <input
              type="search"
              name="searchTerm"
              placeholder="ابحث هنا..."
              aria-label="ابحث في لوحة التحكم"
              [(ngModel)]="searchTerm"
              (ngModelChange)="onSearch()"
            />
          </div>
        </form>
      </div>
      <div class="main-website-button">
        <button
          class="btn website-btn"
          (click)="navigateTo('/home')"
          aria-label="الانتقال إلى الصفحة الرئيسية"
        >
          <i class="fas fa-globe"></i> الصفحة الرئيسية
        </button>
      </div>
    </div>

    <h2 class="dashboard-title">لوحة التحكم الرئيسية</h2>

    <!-- Top Cards -->
    <div class="top-cards">
      <div
        *ngFor="let card of filteredTopCards"
        class="dashboard-card {{ card.colorClass }}"
        [routerLink]="card.route"
        role="button"
        [attr.aria-label]="'الانتقال إلى صفحة ' + card.title"
      >
        <div class="card-content">
          <i class="fas {{ card.icon }} card-icon"></i>
          <div>
            <h3 class="card-title">{{ card.title }}</h3>
            <p class="card-count" *ngIf="card.count !== undefined">{{ card.count }}</p>
          </div>
        </div>
        <p class="card-description">{{ card.description }}</p>
      </div>
    </div>

    <!-- Divider -->
    <hr class="section-divider" />

    <!-- Statistics Section -->
    <div class="stats-section">
      <div class="section-header">
        <h3 class="section-title">
          <i class="fas fa-chart-bar"></i>
          أكثر العيادات حجوزات في آخر 30 يوم
        </h3>
        <div class="loading-indicator" *ngIf="loadingStats">
          <i class="fas fa-spinner fa-spin"></i>
          جاري التحميل...
        </div>
      </div>

      <div class="stats-container" *ngIf="!loadingStats">
        <div class="top-clinics-chart" *ngIf="topClinics.length > 0; else noData">
          <canvas #topClinicsChart id="topClinicsChart"></canvas>
        </div>

        <ng-template #noData>
          <div class="no-data">
            <i class="fas fa-inbox"></i>
            <p>لا توجد بيانات حجوزات في آخر 30 يوم</p>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Another Divider -->
    <hr class="section-divider" />

    <!-- Additional Cards -->
    <div class="additional-cards">
      <div
        *ngFor="let card of filteredAdditionalCards"
        class="additional-card"
        (click)="navigateTo(card.route)"
        role="button"
        [attr.aria-label]="'الانتقال إلى صفحة ' + card.title"
      >
        <div class="card-content">
          <i class="fas {{ card.icon }} card-icon"></i>
          <h3 class="card-title">{{ card.title }}</h3>
        </div>
        <p class="card-description">{{ card.description }}</p>
      </div>
    </div>
  </div>
</section>
